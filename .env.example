# RagShield Environment Variables
# Copy this file to .env and fill in your values
# NEVER commit .env to version control!

# =============================================================================
# REQUIRED: OpenAI API Key
# =============================================================================

# Your OpenAI API key - REQUIRED for:
#   1. LLM cleaning (recommended for best accuracy ~90%)
#   2. Finetuning the embedding model (data preparation step)
#
# Get your key from: https://platform.openai.com/api-keys
# Cost: ~$0.0003 per document for cleaning, ~$3-5 total for finetuning
OPENAI_API_KEY=sk-...

# =============================================================================
# Embedding Model Configuration
# =============================================================================

# Provider: "local" uses sentence-transformers (recommended)
# RAGSHIELD_EMBEDDINGS__PROVIDER=local

# Model path - use your finetuned model for best accuracy (~95%)
# After running: python scripts/finetune_local.py
# RAGSHIELD_EMBEDDINGS__MODEL=./ragshield-embeddings-finetuned
#
# Or use a pre-trained model (less accurate but no finetuning needed):
#   - all-MiniLM-L6-v2    (fast, ~70% accuracy)
#   - all-mpnet-base-v2   (better, ~80% accuracy)
# RAGSHIELD_EMBEDDINGS__MODEL=all-MiniLM-L6-v2

# =============================================================================
# Text Cleaning Configuration
# =============================================================================

# Cleaning method - how RagShield removes injection patterns before comparing
#
# Options:
#   - "heuristic"  : Free, fast, regex-based (~70% accuracy)
#   - "llm"        : Uses GPT-4o-mini, ~$0.0003/doc (~90% accuracy) [RECOMMENDED]
#
# RAGSHIELD_CLEANING__METHOD=llm

# LLM model for cleaning (when method=llm)
# gpt-4o-mini is cheapest and works great for this task
# RAGSHIELD_CLEANING__LLM_MODEL=gpt-4o-mini

# =============================================================================
# ZEDD Detection Threshold
# =============================================================================

# Threshold determines when text is flagged as suspicious
#
# How it works:
#   - ZEDD computes "drift" = how much text changes after cleaning
#   - If drift > threshold â†’ suspicious
#
# Options:
#   - Leave empty/null : Auto-load from model's calibration.json [RECOMMENDED]
#   - Set explicit value: e.g., 0.0083 (from your finetuned model)
#
# Higher threshold = fewer false positives, might miss some attacks
# Lower threshold  = catches more attacks, but more false positives
#
# RAGSHIELD_ZEDD__THRESHOLD=

# =============================================================================
# Behavior on Detection
# =============================================================================

# What to do when a prompt injection is detected
#
# Options:
#   - "block"  : Raise PromptInjectionDetected exception (strict)
#   - "filter" : Remove suspicious documents silently (recommended for RAG)
#   - "flag"   : Add metadata but pass through (for logging/monitoring)
#   - "warn"   : Log warning but pass through (permissive)
#
# RAGSHIELD_BEHAVIOR__ON_DETECT=filter

# Minimum confidence to trigger the on_detect action (0.0 to 1.0)
# Higher = only act on high-confidence detections
# RAGSHIELD_BEHAVIOR__CONFIDENCE_THRESHOLD=0.5

# =============================================================================
# Performance Settings
# =============================================================================

# Batch size for embedding operations (higher = faster but more memory)
# RAGSHIELD_PERFORMANCE__BATCH_SIZE=32

# Cache embeddings to avoid recomputing for repeated texts
# RAGSHIELD_PERFORMANCE__CACHE_EMBEDDINGS=true

# =============================================================================
# Logging
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR
# RAGSHIELD_LOGGING__LEVEL=INFO

# =============================================================================
# Finetuning Configuration (for scripts/finetune_local.py)
# =============================================================================

# These are used when running the finetuning script, not at runtime

# Max samples to process (more = better model but higher API cost)
# Default: 5000 samples costs ~$3-5 in OpenAI API calls
# FINETUNE_MAX_SAMPLES=5000

# Training batch size (reduce if you get OOM errors)
# For 16GB Mac: use 8
# For 8GB Mac: use 4
# FINETUNE_BATCH_SIZE=8

# Output directory for finetuned model
# FINETUNE_OUTPUT_DIR=./ragshield-embeddings-finetuned
